---
layout: post
title: ''
date: 2010-05-06 06:53:00.000000000 +10:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- sql default schedule
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '5316974715412111982'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>I don't often post random snippets of SQL, but I thought this was a good one. Rare enough to be able to forget it easily, and perhaps will be required again.</p>
<p>This returns schedules based on the schedule id(s) that is/are current for a given employee during a given payment period. If there is no schedule id default to 'UOA01'.</p>
<p>The first part was tricky as sch_assign is an effective dated table, and has no <i>required</i> end date, but each row does end when the next effective date comes into effect. I solved that using a subselect to derive the end_dt. Easy enough.</p>
<p>The next part, defaulting in 'UOA01' was a little trickier. A union to always bring in UOA01, but then a not exists subselect to only bring in where part A of the union returned nothing.</p>
<p>Perhaps easy when you see the solution first, this one took me quite a few attempts, and half the afternoon. Saved for prosperity and that time in the future when I ask myself "I remember doing similar...".</p>
<p>Apart from doing some tricky things with dates this SQL always returns a value. There is a default value in the SQL.</p>
<pre style="background-color:#eeeeee;border:1px dashed rgb(153,153,153);color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>select<br />  %DateOut(dur)<br />, b.sched_hrs<br />from<br />    (select<br />      a.schedule_id<br />    , a.effdt as bgn_dt<br />    ,<br />        (select min(x.effdt) - 1<br />        from ps_sch_assign x<br />        where x.emplid = a.emplid<br />        and x.empl_rcd = a.empl_rcd<br />        and x.effdt &lt; a.effdt) as end_dt<br />    from %Table(sch_assign) a<br />    where a.emplid = %Bind(cc_a20_uoa_aet.emplid)<br />    and a.empl_rcd = %Bind(cc_a20_uoa_aet.empl_rcd)<br />    and a.schedule_id  ' '<br />    and a.effdt &lt; %Bind(cc_a20_uoa_aet.prd_end_dt)<br />    union<br />    select <br />      'UOA01'<br />    , to_date('01/01/2000', 'dd/mm/yyyy') as bgn_dt<br />    , to_date('31/12/9999', 'dd/mm/yyyy') as end_dt<br />    from dual<br />    where not exists<br />        (select 1<br />        from %Table(sch_assign) a<br />        where a.emplid = %Bind(cc_a20_uoa_aet.emplid)<br />        and a.empl_rcd = %Bind(cc_a20_uoa_aet.empl_rcd)<br />        and a.schedule_id  ' '<br />        and a.effdt &lt; %Bind(cc_a20_uoa_aet.prd_end_dt))) a<br />, %Table(sch_clnd_vw) b<br />where b.schedule_id = a.schedule_id<br />and b.dur between %Bind(cc_a20_uoa_aet.prd_bgn_dt) and %Bind(cc_a20_uoa_aet.prd_end_dt)<br />and (b.dur &lt;= a.end_dt or a.end_dt is null)<br />and b.sched_hrs &gt; 0<br />order by dur<br /></code></pre>

---
layout: post
title: Modifying v7 SQL that uses Variable Data
date: 2012-10-04 04:12:00.000000000 +10:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- http://schemas.google.com/blogger/2008/kind#post
- VAR_DATA_xxxx
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '7924522042549319447'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>While upgrading (if there are any more upgrades) you'll eventually encounter a piece of SQL that filters on, say PS_PERSON_COMMUNICATION.ADMIN_FUNCTION and ACAD_CAREER. The latter is now on <i><b>many</b></i> child tables; VAR_DATA_XXXX.</p>
<p>For example:</p>
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>select<br />  to_char(a.comment_dttm,'dd/mm/yyyy hh24:mi:ss')<br />, a.cmnt_category<br />, a.deptid<br />, a.cmnt_id<br />, a.comment_dt<br />, a.comments<br />from<br />  ps_person_comment a<br />where a.emplid = :1<br />and a.admin_function = :4<br />and a.acad_career=:2<br />and a.stdnt_car_nbr = :3<br />;<br /></code></pre>
<p>This can be resolved to something like the following, where the subselect/temp-table/on-the-fly thingies there are populated by a union between all VAR_DATA_XXXX tables that use ACAD_CAREER and STDNT_CAR_NBR</p>
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>select<br />  to_char(a.comment_dttm,'dd/mm/yyyy hh24:mi:ss')<br />, a.cmnt_category<br />, a.deptid<br />, a.cmnt_id<br />, a.comment_dt<br />, a.comments<br /><br />from<br />  ps_person_comment a<br />,<br />    (select 'ADMA' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_ADMA<br />    union<br />    select 'ADMP' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_ADMP<br />    union<br />    select 'CASN' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_CASN<br />    union<br />    select 'IPT1' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_IPT1<br />    union<br />    select 'SPRG' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_SPRG<br />    union<br />    select 'THES' as admin_function, common_id, var_data_seq, acad_career, stdnt_car_nbr from ps_VAR_DATA_THES) x<br /><br />where a.common_id = &amp;1<br />and a.admin_function = &amp;4<br />and a.cmnt_id = b.emplid<br />and x.admin_function = a.admin_function<br />and x.common_id = a.common_id<br />and x.var_data_seq = a.var_data_seq<br />and x.acad_career = &amp;2<br />and x.stdnt_car_nbr = &amp;3<br />;<br /></code></pre>

---
layout: post
title: Collections - SQL to create new from old
date: 2007-05-02 00:11:00.000000000 +10:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Collections
- http://schemas.google.com/blogger/2008/kind#post
- OR
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '2060927736150780990'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>For Office of Research at Griffith University - Code to rollover an existing Collection to a new Collection keeping the existing one's Questions and Responses.</p>
<p><span style="font-size:78%;"><span style="font-family:courier new;">-- GUR_COLL_RES<br />insert into sysadm.ps_gur_coll_res<br />select<br />  'RQF_2007'<br />, to_date('08/05/2007', 'dd/mm/yyyy')<br />, EMPLID<br />, 'NEW'<br />, ' '<br />, 0<br />, ''<br />from sysadm.ps_gur_coll_res<br />where gur_collect_cd = 'RQF_TRIAL'<br />and gur_open_date = to_date('30/03/2006', 'dd/mm/yyyy')<br />;</p>
<p>-- GUR_COLL_RESDTL<br />DECLARE<br />    CURSOR PS_CURSOR IS<br />        SELECT<br />            'RQF_2007' as GUR_COLLECT_CD,<br />            to_date('08/05/2007', 'dd/mm/yyyy') as GUR_OPEN_DATE,<br />            EMPLID,<br />            GUR_SECTION_NR,<br />            GUR_QUESTION_NBR,<br />            GUR_FLD_EVIDENCE,<br />            GUR_FLD_RETAINED,<br />            GUR_FLD_EVI_RET,<br />            GUR_RESPONSE_LNG<br />        FROM sysadm.PS_GUR_COLL_RESDTL<br />        where gur_collect_cd = 'RQF_TRIAL'<br />        and gur_open_date = to_date('30/03/2006', 'dd/mm/yyyy');<br />    PS_REC PS_CURSOR%ROWTYPE;<br />    COMMIT_INTERVAL CONSTANT INTEGER := 10000;<br />    RECORDS_PROCESSED INTEGER := 0;<br />BEGIN<br />    OPEN PS_CURSOR;<br />LOOP<br />    FETCH PS_CURSOR INTO PS_REC;<br />    EXIT WHEN PS_CURSOR%NOTFOUND;<br />    INSERT INTO sysadm.PS_GUR_COLL_RESDTL (<br />        GUR_COLLECT_CD,<br />        GUR_OPEN_DATE,<br />        EMPLID,<br />        GUR_SECTION_NR,<br />        GUR_QUESTION_NBR,<br />        GUR_FLD_EVIDENCE,<br />        GUR_FLD_RETAINED,<br />        GUR_FLD_EVI_RET,<br />        GUR_RESPONSE_LNG)<br />    VALUES (<br />        PS_REC.GUR_COLLECT_CD,<br />        PS_REC.GUR_OPEN_DATE,<br />        PS_REC.EMPLID,<br />        PS_REC.GUR_SECTION_NR,<br />        PS_REC.GUR_QUESTION_NBR,<br />        PS_REC.GUR_FLD_EVIDENCE,<br />        PS_REC.GUR_FLD_RETAINED,<br />        PS_REC.GUR_FLD_EVI_RET,<br />        PS_REC.GUR_RESPONSE_LNG);<br />    RECORDS_PROCESSED := RECORDS_PROCESSED + 1;<br />    IF RECORDS_PROCESSED = COMMIT_INTERVAL THEN<br />        COMMIT;<br />        RECORDS_PROCESSED := 0;<br />    END IF;<br />END LOOP;<br />COMMIT;<br />CLOSE PS_CURSOR;<br />END;</p>
<p>-- GUR_COLL_FILE<br />/<br />DECLARE<br />    CURSOR PS_CURSOR IS<br />        SELECT<br />            'RQF_2007' as GUR_COLLECT_CD,<br />            to_date('08/05/2007', 'dd/mm/yyyy') as GUR_OPEN_DATE,<br />            EMPLID,<br />            GUR_SECTION_NR,<br />            GUR_QUESTION_NBR,<br />            SEQNO,<br />            ATTACHSYSFILENAME,<br />            ATTACHUSERFILE,<br />            GUR_PRE_POST_VERS,<br />            GUR_EMPLID,<br />            DATETIME_STAMP,<br />            GUR_EP_STATUS,<br />            GUR_EP_URL,<br />            GUR_ADD_EPRINTS,<br />            GUR_DEL_EPRINTS,<br />            GUR_ALLOW_PUBLSH,<br />            GUR_CONF_EMAIL,<br />            GUR_AUTHORISED,<br />            GUR_VERIFIED,<br />            GUR_DECLINED,<br />            GUR_REFORMATTED,<br />            GUR_ENTBY_EP_STAFF,<br />            GUR_PROCESS_FLAG,<br />            DESCRLONG<br />        FROM sysadm.PS_GUR_COLL_FILE<br />        where gur_collect_cd = 'RQF_TRIAL'<br />        and gur_open_date = to_date('30/03/2006', 'dd/mm/yyyy');<br />    PS_REC PS_CURSOR%ROWTYPE;<br />    COMMIT_INTERVAL CONSTANT INTEGER := 10000;<br />    RECORDS_PROCESSED INTEGER := 0;<br />BEGIN<br />    OPEN PS_CURSOR;<br />LOOP<br />    FETCH PS_CURSOR INTO PS_REC;<br />    EXIT WHEN PS_CURSOR%NOTFOUND;<br />    INSERT INTO sysadm.PS_GUR_COLL_FILE (<br />        GUR_COLLECT_CD,<br />        GUR_OPEN_DATE,<br />        EMPLID,<br />        GUR_SECTION_NR,<br />        GUR_QUESTION_NBR,<br />        SEQNO,<br />        ATTACHSYSFILENAME,<br />        ATTACHUSERFILE,<br />        GUR_PRE_POST_VERS,<br />        GUR_EMPLID,<br />        DATETIME_STAMP,<br />        GUR_EP_STATUS,<br />        GUR_EP_URL,<br />        GUR_ADD_EPRINTS,<br />        GUR_DEL_EPRINTS,<br />        GUR_ALLOW_PUBLSH,<br />        GUR_CONF_EMAIL,<br />        GUR_AUTHORISED,<br />        GUR_VERIFIED,<br />        GUR_DECLINED,<br />        GUR_REFORMATTED,<br />        GUR_ENTBY_EP_STAFF,<br />        GUR_PROCESS_FLAG,<br />        DESCRLONG)<br />    VALUES (<br />        PS_REC.GUR_COLLECT_CD,<br />        PS_REC.GUR_OPEN_DATE,<br />        PS_REC.EMPLID,<br />        PS_REC.GUR_SECTION_NR,<br />        PS_REC.GUR_QUESTION_NBR,<br />        PS_REC.SEQNO,<br />        PS_REC.ATTACHSYSFILENAME,<br />        PS_REC.ATTACHUSERFILE,<br />        PS_REC.GUR_PRE_POST_VERS,<br />        PS_REC.GUR_EMPLID,<br />        PS_REC.DATETIME_STAMP,<br />        PS_REC.GUR_EP_STATUS,<br />        PS_REC.GUR_EP_URL,<br />        PS_REC.GUR_ADD_EPRINTS,<br />        PS_REC.GUR_DEL_EPRINTS,<br />        PS_REC.GUR_ALLOW_PUBLSH,<br />        PS_REC.GUR_CONF_EMAIL,<br />        PS_REC.GUR_AUTHORISED,<br />        PS_REC.GUR_VERIFIED,<br />        PS_REC.GUR_DECLINED,<br />        PS_REC.GUR_REFORMATTED,<br />        PS_REC.GUR_ENTBY_EP_STAFF,<br />        PS_REC.GUR_PROCESS_FLAG,<br />        PS_REC.DESCRLONG);<br />    RECORDS_PROCESSED := RECORDS_PROCESSED + 1;<br />    IF RECORDS_PROCESSED = COMMIT_INTERVAL THEN<br />        COMMIT;<br />        RECORDS_PROCESSED := 0;<br />    END IF;<br />END LOOP;<br />COMMIT;<br />CLOSE PS_CURSOR;<br />END;<br />/</p>
<p>-- GUR_COLL_RFCD<br />insert into sysadm.ps_gur_coll_rfcd<br />select<br />  'RQF_2007'<br />, to_date('08/05/2007', 'dd/mm/yyyy')<br />, EMPLID<br />, GUR_SECTION_NR<br />, GUR_QUESTION_NBR<br />, GUR_PBLCTN_REF_NR<br />, EFFDT<br />, GUR_FLD_RSRCH<br />, GUR_PERCENT<br />from sysadm.ps_gur_coll_rfcd<br />where gur_collect_cd = 'RQF_TRIAL'<br />and gur_open_date = to_date('30/03/2006', 'dd/mm/yyyy')<br />;<br /></span></span></p>

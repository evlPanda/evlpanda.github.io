---
layout: post
title: When "Page data is inconsistent with database"
date: 2007-04-26 02:28:00.000000000 +10:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Component
- Data
- Field
- Page data inconsistent with database
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '3340741493376842503'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>How we hate this one.  PeopleSoft politely tells you that there is some data (being updated) that is inconsistent with what is in the database.  It is not polite enough to tell you <span style="font-weight:bold;">which</span> data however.</p>
<p>Here is some code to give you a clue.  It returns all data that has changed on the Component.</p>
<p><code><br /><span style="font-size:78%;"><span style="font-family:courier new;">/* Place in the Component.SavePreChange event.</span><br /><span style="font-family:courier new;">   Finds all data that is being updated in a component when saved. */</span></p>
<p><span style="font-family:courier new;">Local integer &amp;i, &amp;amp;amp;amp;j, &amp;k, &amp;r, &amp;f;</span></p>
<p><span style="font-family:courier new;">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></p>
<p><span style="font-family:courier new;">Function CheckRowset(&amp;level as integer, &amp;rs As Rowset)</span></p>
<p>For &amp;i = 1 to &amp;rs.ActiveRowCount</p>
<p><span style="font-family:courier new;">   /* Loop through all Records in the RowSet. */</span><br /><span style="font-family:courier new;">   For &amp;r = 1 To &amp;rs(&amp;i).RecordCount</span></p>
<p><span style="font-family:courier new;">      /* Find Records that have changed. */</span><br /><span style="font-family:courier new;">      Local Record &amp;rec = &amp;rs(&amp;i).GetRecord(&amp;r);</span><br /><span style="font-family:courier new;">      If &amp;rec.IsChanged Then</span></p>
<p><span style="font-family:courier new;">         /* Loop through all the Fields in the Record. */</span><br /><span style="font-family:courier new;">         For &amp;f = 1 To &amp;rec.FieldCount</span></p>
<p><span style="font-family:courier new;">            /* Find Fields that have changed. */</span><br /><span style="font-family:courier new;">            If &amp;rec.GetField(&amp;f).IsChanged Then</span></p>
<p><span style="font-family:courier new;">               Local Field &amp;amp;amp;fld = &amp;rec.GetField(&amp;f);</span><br /><span style="font-family:courier new;">               WinMessage("FIELD CHANGED - Level: " | &amp;level | ", Row: 1, Record: " | &amp;amp;rec.Name | ", Field: " | &amp;fld.Name | ", OriginalValue= " | &amp;fld.OriginalValue | ", Value= " | &amp;fld.Value,0);</span></p>
<p><span style="font-family:courier new;">            End-If;</span></p>
<p><span style="font-family:courier new;">         End-For;</span></p>
<p><span style="font-family:courier new;">      End-If;</span></p>
<p><span style="font-family:courier new;">   End-For;</p>
<p></span></span></code><code><span style="font-size:78%;"><span style="font-family:courier new;">   End-For;</span></span></code><br /><code><span style="font-size:78%;"><br /><span style="font-family:courier new;">End-Function;</span></p>
<p><span style="font-family:courier new;">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  */</span></p>
<p><span style="font-family:courier new;">/* Level 0. */</span><br /><span style="font-family:courier new;">Local Rowset &amp;rowset0 = GetLevel0();</span><br /><span style="font-family:courier new;">CheckRowset(0,&amp;rowset0);</span></p>
<p><span style="font-family:courier new;">/* Level 1. */</span><br /><span style="font-family:courier new;">For &amp;i = 1 To &amp;rowset0(1).ChildCount</span></p>
<p><span style="font-family:courier new;">   Local Rowset &amp;rowset1 = &amp;rowset0(1).GetRowset(&amp;i);</span><br /><span style="font-family:courier new;">   CheckRowset(1,&amp;rowset1);</span></p>
<p><span style="font-family:courier new;">   /* Level 2. */</span><br /><span style="font-family:courier new;">   For &amp;j = 1 To &amp;rowset1(1).ChildCount</span></p>
<p><span style="font-family:courier new;">      Local Rowset &amp;rowset2 = &amp;rowset1(1).GetRowset(&amp;j);</span><br /><span style="font-family:courier new;">      CheckRowset(2,&amp;rowset2);</span></p>
<p><span style="font-family:courier new;">      /* Level 3 (maximum). */</span><br /><span style="font-family:courier new;">      For &amp;k = 1 To &amp;rowset2(1).ChildCount</span></p>
<p><span style="font-family:courier new;">         Local Rowset &amp;rowset3 = &amp;rowset2(1).GetRowset(&amp;k);</span><br /><span style="font-family:courier new;">         CheckRowset(3,&amp;rowset3);</span></p>
<p><span style="font-family:courier new;">      End-For;</span></p>
<p><span style="font-family:courier new;">   End-For;</span></p>
<p><span style="font-family:courier new;">End-For;</span></span><br /></code></p>

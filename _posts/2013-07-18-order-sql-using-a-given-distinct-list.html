---
layout: post
title: Order SQL Using A Given, Distinct List
date: 2013-07-18 00:26:00.000000000 +10:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '2011508802379252843'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>Say you have a requirement of updating the preferred phone number using a given, ad hoc, ordered list, where #1 in the list was the preferred number, if it exists, followed by #2 in the list and so on. Basically order by X, Y, Z.</p>
<p>This SQL will fit the bill:   It's much easier to read the SELECT version first, as we can use the WITH clause:</p>
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>with x_order as<br />      (         select 1 as ord, 'HOME' as phone_type from dual<br />      union all select 2 as ord, 'MOB'  as phone_type from dual<br />      union all select 3 as ord, 'WORK' as phone_type from dual<br />      union all select 4 as ord, 'SWK'  as phone_type from dual<br />      union all select 5 as ord, 'OTR'  as phone_type from dual<br />      union all select 6 as ord, 'FAX'  as phone_type from dual)<br /><br />select * from ps_personal_phone ph<br />where emplid = '12345678'<br />and ph.phone_type =<br />      (select a.phone_type<br />      from<br />        ps_personal_phone a<br />      , x_order b<br />      where a.emplid = ph.emplid<br />      and b.phone_type = a.phone_type<br />      and b.ord =<br />            (select min(b2.ord)<br />            from<br />              ps_personal_phone a2<br />            , x_order b2<br />            where a2.emplid = a.emplid<br />            and b2.phone_type = a2.phone_type))<br />;<br /><br /></code></pre>
<p>And the UPDATE version:  
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>update ps_personal_phone ph<br />set ph.pref_phone_flag = 'Y'<br />where emplid = '12345678'<br />and ph.phone_type =<br />      (select a.phone_type<br />      from<br />        ps_personal_phone a<br />      ,<br />            (         select 1 as ord, 'HOME' as phone_type from dual<br />            union all select 2 as ord, 'MOB' as phone_type from dual<br />            union all select 3 as ord, 'WORK' as phone_type from dual<br />            union all select 4 as ord, 'SWK' as phone_type from dual<br />            union all select 5 as ord, 'OTR' as phone_type from dual<br />            union all select 6 as ord, 'FAX' as phone_type from dual) b<br />      where a.emplid = ph.emplid<br />      and b.phone_type = a.phone_type<br />      and b.ord =<br />            (select min(b2.ord)<br />            from<br />              ps_personal_phone a2<br />            ,<br />                   (         select 1 as ord, 'HOME' as phone_type from dual<br />                   union all select 2 as ord, 'MOB' as phone_type from dual<br />                   union all select 3 as ord, 'WORK' as phone_type from dual<br />                   union all select 4 as ord, 'SWK' as phone_type from dual<br />                   union all select 5 as ord, 'OTR' as phone_type from dual<br />                   union all select 6 as ord, 'FAX' as phone_type from dual) b2<br />            where a2.emplid = a.emplid<br />            and b2.phone_type = a2.phone_type))<br />;<br /><br /></code></pre>

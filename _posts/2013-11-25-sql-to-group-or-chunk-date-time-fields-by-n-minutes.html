---
layout: post
title: SQL to Group or Chunk Date Time Fields by n Minutes
date: 2013-11-25 23:48:00.000000000 +11:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '1587759406079415332'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>Say you want to chunk some statistics data into 10 minute intervals. as of Oracle 11g you can use the <i>extract()</i> function that will pull out hours, minutes and the like from a DateTime column.
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>select<br />  to_date(trunc(dttm_stamp) || ' ' || extract(hour from dttm_stamp) || ':' || lpad(ceil(extract(minute from dttm_stamp)/10 + 0.1) * 10 - 10, 2, '0'), 'dd-mon-yy hh24:mi') as dttm_stamp<br />, count(some_field) "count"<br />from <br />  ps_statistics_table<br />group by<br />  trunc(dttm_stamp) || ' ' || extract(hour from dttm_stamp) || ':' || lpad(ceil(extract(minute from dttm_stamp)/10 + 0.1) * 10 - 10, 2, '0')<br />;<br /></code></pre>
<p>Note the +0.1 bit that handles the range of results, up to that point spanning from 0 to 6. We can't have <i>nn</i>:60 as a vaild DateTime. This is also why we have the -10 part.</p>
<p>Also note that depending on the platform that is actually executing the SQL you may have to fiddle around with the DateTime formats. 'dd-mon-yy hh24:mi' might not cut it for you. PeopleSoft will require 'yyyy-mm-dd hh24:mi' for example.</p>
<p>A breakdown of the entire line:
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>select<br />  dttm_stamp as a<br />, extract(minute from dttm_stamp) as b<br />, ceil(extract(minute from dttm_stamp)/10 + 0.1)  as c<br />, ceil(extract(minute from dttm_stamp)/10 + 0.1) * 10 - 10 as d<br />, lpad(ceil(extract(minute from dttm_stamp)/10 + 0.1) * 10 - 10, 2, '0') as e<br />, trunc(dttm_stamp) || ' ' || extract(hour from dttm_stamp) || ':' || lpad(ceil(extract(minute from dttm_stamp)/10 + 0.1) * 10 - 10, 2, '0') as dttm_stamp<br />from ps_statistics_table<br />;<br /></code></pre>
<p>The final results from the first query:  
<pre style="background-color:#eeeeee;border:1px dashed #999999;color:black;font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;font-size:12px;line-height:14px;overflow:auto;padding:5px;width:100%;"><code>17/11/2013 10:00:00 AM 99<br />17/11/2013 10:10:00 AM 120<br />17/11/2013 10:20:00 AM 50<br />17/11/2013 10:30:00 AM 10<br />17/11/2013 10:40:00 AM 65<br />17/11/2013 10:50:00 AM 77<br />17/11/2013 11:00:00 AM 189<br />17/11/2013 11:10:00 AM 201<br />17/11/2013 11:20:00 AM 235<br />17/11/2013 11:30:00 AM 188<br />17/11/2013 11:40:00 AM 105<br />17/11/2013 11:50:00 AM 77<br /><br /></code></pre>

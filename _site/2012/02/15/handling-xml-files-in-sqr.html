<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Handling XML Files in SQR | The PeopleSoft Experience</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Handling XML Files in SQR" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Nice little example of reading an XML file, {input}, and using it to update values in a Table. Note that it first inserts the XML file&#39;s data into a CLOB field at the end of the Table it is updating. Field.RAWXML. !*******************************************************************************! Procedure: Read-Input-File *! Description: Loads Request File data into Suspense tables *! using Oracle XML DB functions to extract data from the XML * !*******************************************************************************!begin-procedure Read-Input-File #debugp show &#39;&#39;#debugp show &#39;Enter procedure Read-Input-File&#39; ! Read file in open $Request_Filename as {INPUT} for-reading record=32767:fixed_nolf status=#result if #result 0 show {REQUEST_FILE_OPEN_ERR_MSG} stop quiet end-if let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, insert into PS_AMS_CART_RQ_HDR&#39; begin-sql on-error=Sql-ErrorINSERT INTO PS_AMS_CART_RQ_HDR ( PRCSINSTANCE, AMS_SYSTEM_CODE, AMS_CART_TIME_STMP, AMS_ABN_NBR, AMS_CART_USER_ID, AMS_CART_RECS, RAWXML ) values ( #prcs_process_instance, &#39; &#39;, 0, 0, &#39; &#39;, 0, empty_clob() ) end-sql while 1=1 let $xml = &#39;&#39; read {INPUT} into $xml:32767 status=#result if #result 0 show {SUSPENSE_TABLE_ERR_MSG} stop quiet end-if if #end-file break end-if let #xml = length($xml) ! Begin: QC1555 ! The given XML file may have Microsoft Byte Order Mark at the beginning. If so just trim it off else can&#39;t be read. ! http://en.wikipedia.org/wiki/UTF-8#Byte_order_mark let $checkBOM = substr($xml, 1,4) if $checkBOM = &#39;0xEF&#39; or $checkBOM = &#39;0xBB&#39; or $checkBOM = &#39;0xBF&#39; let $xml = substr($xml, 5, #xml - 4) end-if let $checkBOM = substr($xml, 1,3) if $checkBOM = &#39;ï»¿&#39; let $xml = substr($xml, 4, #xml - 3) end-if let #xml = length($xml) ! End: QC1555 #ifdef debugx show &#39;$checkBOM= &#39; $checkBOM show &#39; xml : &#39; $xml#endif let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR(RAWXML)&#39; begin-sql on-error=Sql-Errordeclare cartXml CLOB;;begin SELECT rawXML INTO cartXML FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance FOR UPDATE;; DBMS_LOB.WRITEAPPEND(cartXml, #xml, $xml);;end;;end-sql#ifdef debugx commit#endif end-while let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, select PS_AMS_CART_RQ_HDR&#39; begin-select on-error=Sql-Errorhdr.systemCodehdr.cartTimeStamphdr.instAbnhdr.userIdhdr.numRecords FROM XMLTABLE(&#39;/studentStudyCircRequest005&#39; PASSING (SELECT XMLTYPE.createxml(rawXML) FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance) COLUMNS systemCode varchar2(4) PATH &#39;header/system&#39;, cartTimeStamp number(14,0) PATH &#39;header/timestamp&#39;, instAbn number(11,0) PATH &#39;header/instAbn&#39;, userId varchar2(12) PATH &#39;header/userId&#39;, numRecords number(38,0) PATH &#39;trailer/numRecords&#39; ) hdrend-select let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR&#39; begin-sql !on-error=Sql-ErrorUPDATE PS_AMS_CART_RQ_HDR set AMS_SYSTEM_CODE = &amp;hdr.systemCode, AMS_CART_TIME_STMP = &amp;hdr.cartTimeStamp, AMS_ABN_NBR = &amp;hdr.instAbn, AMS_CART_USER_ID = &amp;hdr.userId, AMS_CART_RECS = &amp;hdr.numRecords WHERE PRCSINSTANCE = #prcs_process_instance end-sql" />
<meta property="og:description" content="Nice little example of reading an XML file, {input}, and using it to update values in a Table. Note that it first inserts the XML file&#39;s data into a CLOB field at the end of the Table it is updating. Field.RAWXML. !*******************************************************************************! Procedure: Read-Input-File *! Description: Loads Request File data into Suspense tables *! using Oracle XML DB functions to extract data from the XML * !*******************************************************************************!begin-procedure Read-Input-File #debugp show &#39;&#39;#debugp show &#39;Enter procedure Read-Input-File&#39; ! Read file in open $Request_Filename as {INPUT} for-reading record=32767:fixed_nolf status=#result if #result 0 show {REQUEST_FILE_OPEN_ERR_MSG} stop quiet end-if let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, insert into PS_AMS_CART_RQ_HDR&#39; begin-sql on-error=Sql-ErrorINSERT INTO PS_AMS_CART_RQ_HDR ( PRCSINSTANCE, AMS_SYSTEM_CODE, AMS_CART_TIME_STMP, AMS_ABN_NBR, AMS_CART_USER_ID, AMS_CART_RECS, RAWXML ) values ( #prcs_process_instance, &#39; &#39;, 0, 0, &#39; &#39;, 0, empty_clob() ) end-sql while 1=1 let $xml = &#39;&#39; read {INPUT} into $xml:32767 status=#result if #result 0 show {SUSPENSE_TABLE_ERR_MSG} stop quiet end-if if #end-file break end-if let #xml = length($xml) ! Begin: QC1555 ! The given XML file may have Microsoft Byte Order Mark at the beginning. If so just trim it off else can&#39;t be read. ! http://en.wikipedia.org/wiki/UTF-8#Byte_order_mark let $checkBOM = substr($xml, 1,4) if $checkBOM = &#39;0xEF&#39; or $checkBOM = &#39;0xBB&#39; or $checkBOM = &#39;0xBF&#39; let $xml = substr($xml, 5, #xml - 4) end-if let $checkBOM = substr($xml, 1,3) if $checkBOM = &#39;ï»¿&#39; let $xml = substr($xml, 4, #xml - 3) end-if let #xml = length($xml) ! End: QC1555 #ifdef debugx show &#39;$checkBOM= &#39; $checkBOM show &#39; xml : &#39; $xml#endif let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR(RAWXML)&#39; begin-sql on-error=Sql-Errordeclare cartXml CLOB;;begin SELECT rawXML INTO cartXML FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance FOR UPDATE;; DBMS_LOB.WRITEAPPEND(cartXml, #xml, $xml);;end;;end-sql#ifdef debugx commit#endif end-while let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, select PS_AMS_CART_RQ_HDR&#39; begin-select on-error=Sql-Errorhdr.systemCodehdr.cartTimeStamphdr.instAbnhdr.userIdhdr.numRecords FROM XMLTABLE(&#39;/studentStudyCircRequest005&#39; PASSING (SELECT XMLTYPE.createxml(rawXML) FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance) COLUMNS systemCode varchar2(4) PATH &#39;header/system&#39;, cartTimeStamp number(14,0) PATH &#39;header/timestamp&#39;, instAbn number(11,0) PATH &#39;header/instAbn&#39;, userId varchar2(12) PATH &#39;header/userId&#39;, numRecords number(38,0) PATH &#39;trailer/numRecords&#39; ) hdrend-select let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR&#39; begin-sql !on-error=Sql-ErrorUPDATE PS_AMS_CART_RQ_HDR set AMS_SYSTEM_CODE = &amp;hdr.systemCode, AMS_CART_TIME_STMP = &amp;hdr.cartTimeStamp, AMS_ABN_NBR = &amp;hdr.instAbn, AMS_CART_USER_ID = &amp;hdr.userId, AMS_CART_RECS = &amp;hdr.numRecords WHERE PRCSINSTANCE = #prcs_process_instance end-sql" />
<link rel="canonical" href="http://localhost:4000/2012/02/15/handling-xml-files-in-sqr.html" />
<meta property="og:url" content="http://localhost:4000/2012/02/15/handling-xml-files-in-sqr.html" />
<meta property="og:site_name" content="The PeopleSoft Experience" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-02-15T23:23:00+11:00" />
<script type="application/ld+json">
{"description":"Nice little example of reading an XML file, {input}, and using it to update values in a Table. Note that it first inserts the XML file&#39;s data into a CLOB field at the end of the Table it is updating. Field.RAWXML. !*******************************************************************************! Procedure: Read-Input-File *! Description: Loads Request File data into Suspense tables *! using Oracle XML DB functions to extract data from the XML * !*******************************************************************************!begin-procedure Read-Input-File #debugp show &#39;&#39;#debugp show &#39;Enter procedure Read-Input-File&#39; ! Read file in open $Request_Filename as {INPUT} for-reading record=32767:fixed_nolf status=#result if #result 0 show {REQUEST_FILE_OPEN_ERR_MSG} stop quiet end-if let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, insert into PS_AMS_CART_RQ_HDR&#39; begin-sql on-error=Sql-ErrorINSERT INTO PS_AMS_CART_RQ_HDR ( PRCSINSTANCE, AMS_SYSTEM_CODE, AMS_CART_TIME_STMP, AMS_ABN_NBR, AMS_CART_USER_ID, AMS_CART_RECS, RAWXML ) values ( #prcs_process_instance, &#39; &#39;, 0, 0, &#39; &#39;, 0, empty_clob() ) end-sql while 1=1 let $xml = &#39;&#39; read {INPUT} into $xml:32767 status=#result if #result 0 show {SUSPENSE_TABLE_ERR_MSG} stop quiet end-if if #end-file break end-if let #xml = length($xml) ! Begin: QC1555 ! The given XML file may have Microsoft Byte Order Mark at the beginning. If so just trim it off else can&#39;t be read. ! http://en.wikipedia.org/wiki/UTF-8#Byte_order_mark let $checkBOM = substr($xml, 1,4) if $checkBOM = &#39;0xEF&#39; or $checkBOM = &#39;0xBB&#39; or $checkBOM = &#39;0xBF&#39; let $xml = substr($xml, 5, #xml - 4) end-if let $checkBOM = substr($xml, 1,3) if $checkBOM = &#39;ï»¿&#39; let $xml = substr($xml, 4, #xml - 3) end-if let #xml = length($xml) ! End: QC1555 #ifdef debugx show &#39;$checkBOM= &#39; $checkBOM show &#39; xml : &#39; $xml#endif let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR(RAWXML)&#39; begin-sql on-error=Sql-Errordeclare cartXml CLOB;;begin SELECT rawXML INTO cartXML FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance FOR UPDATE;; DBMS_LOB.WRITEAPPEND(cartXml, #xml, $xml);;end;;end-sql#ifdef debugx commit#endif end-while let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, select PS_AMS_CART_RQ_HDR&#39; begin-select on-error=Sql-Errorhdr.systemCodehdr.cartTimeStamphdr.instAbnhdr.userIdhdr.numRecords FROM XMLTABLE(&#39;/studentStudyCircRequest005&#39; PASSING (SELECT XMLTYPE.createxml(rawXML) FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance) COLUMNS systemCode varchar2(4) PATH &#39;header/system&#39;, cartTimeStamp number(14,0) PATH &#39;header/timestamp&#39;, instAbn number(11,0) PATH &#39;header/instAbn&#39;, userId varchar2(12) PATH &#39;header/userId&#39;, numRecords number(38,0) PATH &#39;trailer/numRecords&#39; ) hdrend-select let $SQL-STATEMENT = &#39;amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR&#39; begin-sql !on-error=Sql-ErrorUPDATE PS_AMS_CART_RQ_HDR set AMS_SYSTEM_CODE = &amp;hdr.systemCode, AMS_CART_TIME_STMP = &amp;hdr.cartTimeStamp, AMS_ABN_NBR = &amp;hdr.instAbn, AMS_CART_USER_ID = &amp;hdr.userId, AMS_CART_RECS = &amp;hdr.numRecords WHERE PRCSINSTANCE = #prcs_process_instance end-sql","@type":"BlogPosting","url":"http://localhost:4000/2012/02/15/handling-xml-files-in-sqr.html","headline":"Handling XML Files in SQR","dateModified":"2012-02-15T23:23:00+11:00","datePublished":"2012-02-15T23:23:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2012/02/15/handling-xml-files-in-sqr.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="The PeopleSoft Experience" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">The PeopleSoft Experience</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Handling XML Files in SQR</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2012-02-15T23:23:00+11:00" itemprop="datePublished">Feb 15, 2012
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{"login"=>"evlpanda", "email"=>"m.nitschke@gmail.com", "display_name"=>"Michael Nitschke", "first_name"=>"", "last_name"=>""}</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Nice little example of reading an XML file, {input}, and using it to update values in a Table. Note that it first inserts the XML file's data into a CLOB field at the end of the Table it is updating. Field.RAWXML.</p>
<p> 
<pre style="font-family:Andale Mono, Lucida Console, Monaco, fixed, monospace;color:#000000;background-color:#eee;font-size:12px;border:1px dashed #999999;line-height:14px;padding:5px;overflow:auto;width:100%;"><code>!*******************************************************************************<br />! Procedure:  Read-Input-File                                                  *<br />! Description: Loads Request File data into Suspense tables                    *<br />!              using Oracle XML DB functions to extract data from the XML      *      <br />!*******************************************************************************<br />!<br />begin-procedure Read-Input-File    <br /><br />#debugp show ''<br />#debugp show 'Enter procedure Read-Input-File'<br /><br />  ! Read file in <br />  open $Request_Filename as {INPUT} for-reading record=32767:fixed_nolf status=#result<br />  if #result  0<br />    show {REQUEST_FILE_OPEN_ERR_MSG}<br />    stop quiet<br />  end-if<br /><br />  let $SQL-STATEMENT = 'amssr197.sqr, Read-Input-File, insert into PS_AMS_CART_RQ_HDR' <br />  <br />begin-sql on-error=Sql-Error<br />INSERT INTO PS_AMS_CART_RQ_HDR (<br />        PRCSINSTANCE,<br />        AMS_SYSTEM_CODE,<br />        AMS_CART_TIME_STMP,<br />        AMS_ABN_NBR,<br />        AMS_CART_USER_ID,<br />        AMS_CART_RECS,<br />        RAWXML<br />   ) values ( <br />        #prcs_process_instance,<br />        ' ',<br />        0,<br />        0,<br />        ' ',<br />        0,<br />        empty_clob()<br />    )        <br />end-sql<br /><br />  <br />  while 1=1<br />    let $xml = ''<br />    read {INPUT} into $xml:32767 status=#result<br />    <br />    if #result  0<br />        show {SUSPENSE_TABLE_ERR_MSG}<br />        stop quiet<br />    end-if<br />    if #end-file<br />        break<br />    end-if<br />    <br />        let #xml = length($xml)<br />        <br />    ! Begin: QC1555<br />    ! The given XML file may have Microsoft Byte Order Mark at the beginning. If so just trim it off else can't be read.<br />    ! http://en.wikipedia.org/wiki/UTF-8#Byte_order_mark<br />    let $checkBOM = substr($xml, 1,4) <br />    if $checkBOM = '0xEF' or $checkBOM = '0xBB' or $checkBOM = '0xBF'<br />        let $xml = substr($xml, 5, #xml - 4)<br />    end-if <br />    let $checkBOM = substr($xml, 1,3) <br />    if $checkBOM = 'ï»¿' <br />        let $xml = substr($xml, 4, #xml - 3)<br />    end-if<br />    let #xml = length($xml)<br />    ! End: QC1555<br />    <br />#ifdef debugx<br />         show '$checkBOM= ' $checkBOM<br />        show '    xml : ' $xml<br />#endif <br /><br />    let $SQL-STATEMENT = 'amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR(RAWXML)' <br />  <br />begin-sql on-error=Sql-Error<br />declare<br />    cartXml CLOB;;<br />begin<br />    SELECT rawXML INTO cartXML<br />    FROM PS_AMS_CART_RQ_HDR <br />    WHERE PRCSINSTANCE = #prcs_process_instance<br />    FOR UPDATE;;<br />    <br />    DBMS_LOB.WRITEAPPEND(cartXml, #xml, $xml);;<br />end;;<br />end-sql<br />#ifdef debugx<br />    commit<br />#endif<br /><br />  end-while<br />  <br />  let $SQL-STATEMENT = 'amssr197.sqr, Read-Input-File, select PS_AMS_CART_RQ_HDR' <br />  <br />begin-select on-error=Sql-Error<br />hdr.systemCode<br />hdr.cartTimeStamp<br />hdr.instAbn<br />hdr.userId<br />hdr.numRecords<br /><br />   FROM <br />   XMLTABLE('/studentStudyCircRequest005'<br />      PASSING (SELECT XMLTYPE.createxml(rawXML) FROM PS_AMS_CART_RQ_HDR WHERE PRCSINSTANCE = #prcs_process_instance) <br />      COLUMNS<br />        systemCode      varchar2(4)  PATH 'header/system',<br />        cartTimeStamp   number(14,0) PATH 'header/timestamp',<br />        instAbn         number(11,0) PATH 'header/instAbn',<br />        userId          varchar2(12) PATH 'header/userId',<br />        numRecords      number(38,0) PATH 'trailer/numRecords'<br />        ) hdr<br />end-select<br /><br />    let $SQL-STATEMENT = 'amssr197.sqr, Read-Input-File, update PS_AMS_CART_RQ_HDR' <br />  <br />begin-sql !on-error=Sql-Error<br />UPDATE PS_AMS_CART_RQ_HDR <br />        set AMS_SYSTEM_CODE    = &amp;hdr.systemCode,<br />            AMS_CART_TIME_STMP = &amp;hdr.cartTimeStamp,<br />            AMS_ABN_NBR        = &amp;hdr.instAbn,<br />            AMS_CART_USER_ID   = &amp;hdr.userId,<br />            AMS_CART_RECS      = &amp;hdr.numRecords<br />   WHERE PRCSINSTANCE = #prcs_process_instance <br />end-sql   <br /></code></pre>

  </div><a class="u-url" href="/2012/02/15/handling-xml-files-in-sqr.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">The PeopleSoft Experience</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">The PeopleSoft Experience</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/evlPanda"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">evlPanda</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Musings, chit-chat, and sometimes useful stuff related to PeopleSoft, especially PeopleCode.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>

---
layout: post
title: PDF Stamper
date: 
type: post
parent_id: '0'
published: false
password: ''
status: draft
categories: []
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '6890256610321726779'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<p>Local JavaObject &amp;Outputstream, &amp;PDFWriter, &amp;PDFReader, &amp;PDFStamper, &amp;TemplateFields;</p>
<p>/* File name */<br />Evaluate &amp;recAMS_CAF_DAT_VW.AMS_CAF_TYPE.Value<br />When = "C"<br />   /* Pivot date for old/new form is 22/12/2010 */<br />   If &amp;recAMS_CAF_DAT_VW.EFFDT.Value &gt;= Date(20101222) Then<br />      &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1290A_NEW_TEMPLATE.pdf";<br />   Else<br />      &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1290A_OLD_TEMPLATE.pdf";<br />   End-If;<br />When = "F"<br />   /* There is a really old form version, pre 2009. */<br />   If &amp;recAMS_CAF_DAT_VW.EFFDT.Value &gt;= Date(20090101) Then<br />      &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1292A_OLDOLD_TEMPLATE.pdf";<br />   Else<br />      /* Pivot date for old/new form is 22/12/2010 */<br />      If &amp;recAMS_CAF_DAT_VW.EFFDT.Value &gt;= Date(20101222) Then<br />         &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1292A_NEW_TEMPLATE.pdf";<br />      Else<br />         &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1292A_OLD_TEMPLATE.pdf";<br />      End-If;<br />   End-If;<br />When = "V"<br />   /* Pivot date for old/new form is 22/12/2010 */<br />   If &amp;recAMS_CAF_DAT_VW.EFFDT.Value &gt;= Date(20101222) Then<br />      &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1296A_NEW_TEMPLATE.pdf";<br />   Else<br />      &amp;TemplatePathname = GetEnv("PS_HOME") | "/rmit/tmp/1296A_OLD_TEMPLATE.pdf";<br />   End-If;<br />End-Evaluate;</p>
<p>&amp;FILE = %OperatorId | "_" | %Datetime | "_eCAF_PDF_STAMPER_OUTPUT.pdf";</p>
<p>/* Output File path */<br />/* ps_home = /software/peoplesoft/product/pscs/pscsdv4 */<br />&amp;InOutputPdfPathname = GetEnv("PS_HOME") | "/rmit/tmp/" | &amp;FILE;</p>
<p>/* Create the "input" Template PDF */<br />&amp;PDFReader = CreateJavaObject("com.lowagie.text.pdf.PdfReader", &amp;TemplatePathname);<br />&amp;PDFReader.consolidateNamedDestinations();<br />&amp;PDFReader.removeUnusedObjects();</p>
<p>/* Create the "Output" Template PDF */<br />&amp;Outputstream = CreateJavaObject("java.io.FileOutputStream", &amp;InOutputPdfPathname);<br />&amp;PDFStamper = CreateJavaObject("com.lowagie.text.pdf.PdfStamper", &amp;PDFReader, &amp;Outputstream);</p>
<p>/* Flatten the form */<br />&amp;PDFStamper.setFormFlattening( True);</p>
<p>/* Get the fields to stamp */<br />&amp;TemplateFields = &amp;PDFStamper.getAcroFields();</p>
<p>/* Stamp fields */<br />&amp;TemplateFields.setField("FAMILY_NAME", "Test family name");<br />rem &amp;TemplateFields.setField("name", "John Student");<br />rem &amp;TemplateFields.setField("address", "Baeyensstraat 121, Sint-Amandsberg");<br />rem &amp;TemplateFields.setField("postal_code", "BE-9040");<br />rem &amp;TemplateFields.setField("email", "s1234567@cqu.edu.au");</p>
<p>/* Close the stamper */<br />&amp;PDFStamper.close();</p>
<p>/* Needed if in think-time */<br />CommitWork();</p>
<p>/* Put PDF file temporarily into database, so we can send to users browser using the ViewAttachment function */<br />&amp;Ret = PutAttachment("record://AMS_ECAF_ATTACH", &amp;FILE, &amp;InOutputPdfPathname);<br />If &amp;Ret = %Attachment_Success Then;</p>
<p>   /* Send Output file to the browser */<br />   &amp;Ret = ViewAttachment("record://AMS_ECAF_ATTACH", &amp;FILE, &amp;FILE, True, True);</p>
<p>   /* Remove temporary PDF file from database */<br />   &amp;Ret = DeleteAttachment("record://AMS_ECAF_ATTACH", &amp;FILE, True);</p>
<p>End-If;</p>

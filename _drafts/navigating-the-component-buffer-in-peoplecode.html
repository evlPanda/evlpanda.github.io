---
layout: post
title: Navigating the Component Buffer in PeopleCode
date: 
type: post
parent_id: '0'
published: false
password: ''
status: draft
categories:
- Buffer
- Component
- PeopleCode
tags: []
meta:
  blogger_blog: capital-it.blogspot.com
  blogger_author: Michael Nitschke
  blogger_0c9a3d51488c214aefd1a54a659341d6_permalink: '599879316725811240'
author:
  login: evlpanda
  email: m.nitschke@gmail.com
  display_name: Michael Nitschke
  first_name: ''
  last_name: ''
---
<div class="separator" style="clear:both;text-align:center;"><a href="http://i.imgur.com/qs99yQg.png" style="margin-left:1em;margin-right:1em;"><br /></a></div>
<h3></h3>
<p><b><a href="http://docs.oracle.com/cd/E28394_01/pt852pbh1/eng/psbooks/tpcr/chapter.htm?File=tpcr/htm/tpcr39.htm%23g037ee99c9453fb39_ef90c_10c791ddc07__184d" rel="nofollow" target="_blank">Rowset in PeopleBooks</a></b> (8.52 because 8.53 books are ugly)</p>
<p>This is a topic that a lot of people still seem to have trouble getting their heads around, and I must admit that on some of the more exotic wanderings around the component buffer in my code I can get lost myself.</p>
<p>For our examples we are going to use a Component Buffer comprised of the following Record Structure:</p>
<p><a href="http://i.imgur.com/tbHDyYi.jpg" style="clear:right;float:right;margin-bottom:1em;margin-left:1em;"><img border="0" src="{{ site.baseurl }}/assets/tbHDyYi.jpg" height="246" width="320" /></a>LEVEL_0_TBL<br />    PARENT_A_TBL<br />        CHILD_A_TBL<br />            GRANDCHILD_A_TBL<br />    PARENT_B_TBL<br />        SON_TBL<br />            GRANDSON_B_TBL<br />        DAUGHTER_TBL<br />            GRANDDAUGHTER_A_TBL<br />            GRANDDAUGHTER_B_TBL</p>
<p>I'll endeavour to provide examples for every combination of the above, but hopefully after a few you'll start to see the pattern yourself.</p>
<p>Each example will cover a combination of two of the Records in the example Component Buffer, and will create a Rowset for each, from each. That is I will provide an example of how each Rowset in the buffer can talk to every other Rowset in the buffer.</p>
<p>Where the example is A &gt; B then the PeopleCode is placed on the Record marked as 'A' and creates a Rowset based on the Record marked as 'B', and vice versa.</p>
<p>It is up to you where to put the code in each Rowset; Record PeopleCode or Component PeopleCode. The most appropriate location is worthy of another post.</p>
<p><b>CurrentRowNumber()</b></p>
<p>Note that CurrentRowNumber() is only available for the current Rowset and Rowsets above it. You can't get the current row number for Rowsets below the one executing the code. Think of it as a tree; there is only one path back to the trunk, but many paths out to many leaves. You can always tell which trunk you took to get to the branch you are currently on, but if you want to refer to a leaf then <i>you</i> have to specifically define which one.</p>
<p>From PeopleBooks:<br />This function can determine the current row number on the level where the function call resides, or on a higher scroll level. It won’t work on a scroll level below the one where the PeopleCode program resides. </p>
<p>Note that 'Higher' means higher in the buffer heirarchy. Level 0 is the highest level. Level 3 is the lowest level. Some people have this back-to-front in their understanding. (Yes you Pat)<br />
<h3>Examples with PeopleCode</h3>
<pre><code><br /><b>A LEVEL_0_TBL<br />    B PARENT_A_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset(Scroll.PARENT_A_TBL);<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsLEVEL_0_TBL = GetLevel0();<br /></code></pre>
<pre><code><br /><b>A LEVEL_0_TBL</b><br /><br />      PARENT_A_TBL<br /><br /><b>        B CHILD_A_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset(Scroll.PARENT_A_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_A_TBL.ActiveRowCount<br />    Local Rowset &amp;rsCHILD_A_TBL = &amp;rsPARENT_A_TBL(&amp;i).GetRowset(Scroll.CHILD_A_TBL);<br />End-For;<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsLEVEL_0_TBL = GetLevel0();<br /></code></pre>
<pre><code><br /><b>A LEVEL_0_TBL</b><br /><br />      PARENT_A_TBL<br />          CHILD_A_TBL<br /><b>            B GRANDCHILD_A_TBL</b><br />       <br /><br />A &gt; B<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset(Scroll.PARENT_A_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_A_TBL.ActiveRowCount<br />    Local Rowset &amp;rsCHILD_A_TBL = &amp;rsPARENT_A_TBL(&amp;i).GetRowset(Scroll.CHILD_A_TBL);<br />    For &amp;j = 1 to &amp;rsCHILD_A_TBL.ActiveRowCount<br />        Local Rowset &amp;rsGRANDCHILD_A_TBL = &amp;rsCHILD_A_TBL(&amp;j).GetRowset(Scroll.GRANDCHILD_A_TBL);<br />    End-For;<br />End-For;<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsLEVEL_0_TBL = GetLevel0();<br /></code></pre>
<pre><code><br />LEVEL_0_TBL<br /><b>    A PARENT_A_TBL</b><br /><b>        B CHILD_A_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsCHILD_A_TBL = GetRowset(Scroll.CHILD_A_TBL);<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset().ParentRowset;<br />or<br />Local Rowset &amp;rsPARENT_A_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_A_TBL).GetRow(CurrentRowNumber(1));<br /></code></pre>
<pre><code><br />LEVEL_0_TBL<br /><b>    A PARENT_A_TBL</b><br />          CHILD_A_TBL<br /><b>            B GRANDCHILD_A_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsCHILD_A_TBL = GetRowset(Scroll.CHILD_A_TBL);<br />For &amp;i = 1 to &amp;rsCHILD_A_TBL.ActiveRowCount<br />    Local Rowset &amp;rsGRANDCHILD_A_TBL = &amp;rsCHILD_A_TBL(&amp;j).GetRowset(Scroll.GRANDCHILD_A_TBL);<br />End-For;<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset().ParentRowset.ParentRowset;<br />or<br />Local Rowset &amp;rsPARENT_A_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_A_TBL).GetRow(CurrentRowNumber(1));<br /></code></pre>
<pre><code><br />LEVEL_0_TBL<br />    PARENT_A_TBL<br /><b>        A CHILD_A_TBL</b><br /><b>            B GRANDCHILD_A_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsGRANDCHILD_A_TBL = GetRowset(Scroll.GRANDCHILD_A_TBL);<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetRowset().ParentRowset;<br />or<br />Local Rowset &amp;rsPARENT_A_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_A_TBL).GetRow(CurrentRowNumber(1)).GetRowset(Scroll.CHILD_A_TBL).GetRow(CurrentRowNumber(2));<br /></code></pre>
<p>
<div class="separator" style="clear:both;text-align:center;"><a href="http://i.imgur.com/qs99yQg.png" style="margin-left:1em;margin-right:1em;"><img border="0" src="{{ site.baseurl }}/assets/qs99yQg.png" height="167" width="320" /></a></div>
<p>Now we can go up and down the stairs let's try using our tails like real code-monkeys and swinging from branch to branch.</p>
<p>
<pre><code><br />LEVEL_0_TBL<br />    PARENT_A_TBL<br /><b>        A CHILD_A_TBL</b><br />              GRANDCHILD_A_TBL<br />    PARENT_B_TBL<br /><b>        B SON_TBL</b><br />          GRANDSON_B_TBL<br />        DAUGHTER_TBL<br />            GRANDDAUGHTER_A_TBL<br />            GRANDDAUGHTER_B_TBL<br /><br />A &gt; B<br /><br />Local Rowset &amp;rsPARENT_B_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_B_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_B_TBL.ActiveRowCount<br />    Local Rowset &amp;rsSON_TBL = &amp;rsPARENT_B_TBL(&amp;i).GetRowset(Scroll.SON_TBL);<br />End-For;<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_A_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_A_TBL.ActiveRowCount<br />    Local Rowset &amp;rsCHILD_A_TBL = &amp;rsPARENT_A_TBL(&amp;i).GetRowset(Scroll.CHILD_A_TBL);<br />End-For;<br /></code></pre>
<pre><code><br />LEVEL_0_TBL<br />    PARENT_A_TBL<br />        CHILD_A_TBL<br /><b>            A GRANDCHILD_A_TBL</b><br />    PARENT_B_TBL<br />        SON_TBL<br />            GRANDSON_B_TBL<br />        DAUGHTER_TBL<br />              GRANDDAUGHTER_A_TBL<br /><b>            B GRANDDAUGHTER_B_TBL</b><br /><br />A &gt; B<br /><br />Local Rowset &amp;rsPARENT_B_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_B_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_B_TBL.ActiveRowCount<br />    Local Rowset &amp;rsDAUGHTER_TBL = &amp;rsPARENT_B_TBL(&amp;i).GetRowset(Scroll.DAUGHTER_TBL);<br />    For &amp;j = 1 to &amp;rsDAUGHTER_TBL.ActiveRowCount<br />        Local Rowset &amp;rsGRANDDAUGHTER_B_TBL = &amp;rsDAUGHTER_TBL(&amp;j).GetRowset(Scroll.GRANDDAUGHTER_B_TBL);<br />    End-For;<br />End-For;<br /><br />B &gt; A<br /><br />Local Rowset &amp;rsPARENT_A_TBL = GetLevel0()(1).GetRowset(Scroll.PARENT_A_TBL);<br />For &amp;i = 1 to &amp;rsPARENT_A_TBL.ActiveRowCount<br />    Local Rowset &amp;rsCHILD_A_TBL = &amp;rsPARENT_A_TBL(&amp;i).GetRowset(Scroll.CHILD_A_TBL);<br />    For &amp;j = 1 to &amp;rsCHILD_A_TBL.ActiveRowCount<br />        Local Rowset &amp;rsGRANDCHILD_A_TBL = &amp;rsCHILD_A_TBL(&amp;j).GetRowset(Scroll.GRANDCHILD_A_TBL);<br />    End-For;<br />End-For;<br /></code></pre>
